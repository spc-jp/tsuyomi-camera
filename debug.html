<label>ãƒ†ã‚­ã‚¹ãƒˆï¼ˆbody.textï¼‰</label>
<textarea id="text" rows="4">ãƒ†ã‚¹ãƒˆã§ã™ã€‚å†™çœŸãªã—ã€‚å¼·ã¿æŠ•ç¨¿æ¡ˆã‚’ãã ã•ã„ã€‚</textarea>

<label>ç”»åƒï¼ˆä»»æ„ï¼šimageBase64ï¼‰</label>
<input id="img" type="file" accept="image/*">
<div class="small">ç”»åƒã‚’å…¥ã‚Œã‚‹ã¨ã€base64ã«å¤‰æ›ã—ã¦é€ã‚Šã¾ã™ï¼ˆé‡ã„ã®ã§ã¾ãšã¯å†™çœŸãªã—ã§OKï¼‰</div>
æ¬¡ã«ãŠé¡˜ã„
ã“ã® debug.html ã‚’é–‹ã„ã¦ã€Œãƒ†ã‚¹ãƒˆé€ä¿¡ã€ã‚’æŠ¼ã—ãŸã‚ã¨ã€

çµæœã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆOK/NG ã¨ HTTPç•ªå·ï¼‰

å³ä¸‹ã®é»’ã„æ ã«å‡ºãŸå…¨æ–‡ï¼ˆJSONã‹ã‚¨ãƒ©ãƒ¼æ–‡ï¼‰

ã“ã®2ã¤ã‚’ã€ãã®ã¾ã¾ã“ã“ã«è²¼ã£ã¦ãã ã•ã„ã€‚

ãã‚ŒãŒå‡ºã‚Œã°ã€502ã®åŸå› ã‚’ â€œä¸€ç‚¹ç‰¹å®šâ€ ã—ã¦ã€Cloudflare Workers å´ã®ç›´ã—æ–¹ã‚’ãã®ã¾ã¾å®Œå…¨ã‚³ãƒ”ãƒšã§å‡ºã—ã¾ã™ğŸ‘


<!doctype html> <html lang="ja"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width,initial-scale=1" /> <title>ä¾¡å€¤ã¿ã£ã‘ API ãƒ‡ãƒãƒƒã‚°</title> <style> body{font-family:system-ui,-apple-system,Segoe UI,Meiryo,sans-serif;max-width:900px;margin:20px auto;padding:0 12px;line-height:1.6} h1{font-size:20px;margin:0 0 10px} .box{border:1px solid #ddd;border-radius:10px;padding:12px;margin:10px 0} label{display:block;margin:8px 0 4px} input,textarea{width:100%;box-sizing:border-box;padding:10px;border:1px solid #ccc;border-radius:8px} button{padding:10px 14px;border:0;border-radius:10px;background:#225AD3;color:#fff;cursor:pointer} button:disabled{opacity:.6;cursor:not-allowed} .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center} .small{font-size:12px;color:#666} pre{white-space:pre-wrap;background:#0b1020;color:#e9eefc;padding:12px;border-radius:10px;overflow:auto} .ok{color:#0a7b2f} .ng{color:#b00020} </style> </head> <body> <h1>ä¾¡å€¤ã¿ã£ã‘ API ãƒ‡ãƒãƒƒã‚°ï¼ˆWorkers /chat ãƒ†ã‚¹ãƒˆï¼‰</h1> <div class="box"> <div class="row"> <div style="flex:1;min-width:260px"> <label>API URLï¼ˆ/chat ã¾ã§ï¼‰</label> <input id="apiUrl" value="https://kachi-mikke-spc.yymmatsu.workers.dev/chat"> <div class="small">ä¾‹ï¼š https://kachi-mikke-spc.yymmatsu.workers.dev/chat</div> </div> <div style="min-width:160px"> <label>é€ä¿¡</label> <button id="btn">ãƒ†ã‚¹ãƒˆé€ä¿¡</button> </div> </div> </div> <div class="box"> <div class="row"> <div>çµæœã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š <span id="status">æœªå®Ÿè¡Œ</span></div> <div class="small" id="time"></div> </div> <pre id="out">ã“ã“ã«çµæœãŒå‡ºã¾ã™</pre> </div> <script> const $ = (id) => document.getElementById(id); async function fileToBase64(file){ return new Promise((resolve,reject)=>{ const r = new FileReader(); r.onload = () => resolve(r.result); r.onerror = reject; r.readAsDataURL(file); }); } function setStatus(ok, msg){ $("status").textContent = msg; $("status").className = ok ? "ok" : "ng"; } $("btn").addEventListener("click", async ()=>{ $("btn").disabled = true; setStatus(true, "é€ä¿¡ä¸­â€¦"); $("out").textContent = ""; const url = $("apiUrl").value.trim(); const text = $("text").value || ""; const file = $("img").files && $("img").files[0]; const body = { text }; try{ if(file){ const b64 = await fileToBase64(file); body.imageBase64 = b64; } const t0 = performance.now(); const res = await fetch(url, { method: "POST", headers: { "content-type": "application/json" }, body: JSON.stringify(body) }); const t1 = performance.now(); $("time").textContent = "å¿œç­”æ™‚é–“: " + Math.round(t1 - t0) + "ms"; const contentType = res.headers.get("content-type") || ""; let dataText = ""; if(contentType.includes("application/json")){ const json = await res.json(); dataText = JSON.stringify(json, null, 2); }else{ dataText = await res.text(); } if(res.ok){ setStatus(true, "OKï¼ˆHTTP " + res.status + "ï¼‰"); }else{ setStatus(false, "NGï¼ˆHTTP " + res.status + "ï¼‰"); } $("out").textContent = dataText || "(ç©º)"; }catch(err){ setStatus(false, "é€šä¿¡å¤±æ•—"); $("out").textContent = "ã‚¨ãƒ©ãƒ¼å†…å®¹:\n" + (err && err.message ? err.message : String(err)) + "\n\nç¢ºèªãƒã‚¤ãƒ³ãƒˆ:\nãƒ»API URLãŒ /chat ã¾ã§å…¥ã£ã¦ã„ã‚‹ã‹\nãƒ»Workerså´ã§Deployæ¸ˆã¿ã‹\nãƒ»CORSãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹"; }finally{ $("btn").disabled = false; } }); </script> </body> </html>